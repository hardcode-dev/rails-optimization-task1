1. Урезал файл входной файл до 1000 строк
  прогнал через ruby-prof, получил отчёт 'callstack'
  Вижу, что 99.96% занимает Array#each [3 calls, 10 total]

  10_000 строк - 94.67% (94.67%) Array#each [3 calls, 10 total]
  50_000 строк - я уже не дождался ...

  Ассимтотика не линейная

2. Прогнал через ruby-prof, получил отчёт 'callgrind'

3. Benchmark подтвердил, что Ассимтотика не линейная

```json
                 100:      469.1 i/s
               1_000:       24.6 i/s - 19.05x  slower
              10_000:        0.4 i/s - 1155.92x  slower
```

4. Прогнал через stackprof
  не очень наглядно

5. Привёл результирующий json к читабельному виду, дабы понять, что там должно быть
  Хотя можно было например firefox result.json ))

6. Избавился от лишних each и select. Но пока закомменировал подсчёт общей статистики.

                 100:      612.1 i/s
               1_000:       67.6 i/s - 9.05x  slower
              10_000:        6.5 i/s - 94.45x  slower

Comparison:
               optim:        7.1 i/s
             initial:        0.4 i/s - 18.66x  slower

Стало в 18 раз быстрее, но этого явно недостаточно и тем более, что я убрал общую статистику!

7. Переписал общую статистику

  провкрил через профайлер, теперь узкое место  Object#collect_stats_from_users

8. избавился от collect_stats_from_users
    42 сек выполняется, надо 30 сек
    запускал нескольуо раз чтвло 31.546161186 сек, видимо что-то кешируется

9. to_json занимает примерно 23% времени, пробовал дургие способы
  JSON.dump, JSON.generate, JSON.fast_generate
  все примерно одинаковы

10. Всё упирается в коснтрукции вида array.map { |a| a.split() }
    и в to_json

    Пока не знаю как избавиться от них.

    Время выполнения 33 сек, на 30 сек не вышел.
